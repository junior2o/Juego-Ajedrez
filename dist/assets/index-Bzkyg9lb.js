var he=Object.defineProperty;var ge=(n,e,t)=>e in n?he(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var b=(n,e,t)=>ge(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();const q=class q{constructor(){b(this,"socket",null);b(this,"callbacks",{});b(this,"messageQueue",[]);b(this,"isConnected",!1)}static getInstance(){return q.instance||(q.instance=new q),q.instance}connect(e){this.socket=new WebSocket(e),this.socket.onopen=()=>{console.log("[WebSocket] Connected"),this.isConnected=!0;const t=localStorage.getItem("playerId")||"",o={type:"init_with_id",id:t};for(this.send(o),console.log("[WebSocket] Sent init_with_id:",t);this.messageQueue.length>0;){const s=this.messageQueue.shift();s&&this.send(s)}},this.socket.onmessage=t=>{try{const o=JSON.parse(t.data);this.dispatchMessage(o)}catch{console.error("[WebSocket] Invalid message received:",t.data)}},this.socket.onclose=()=>{console.warn("[WebSocket] Disconnected"),this.isConnected=!1},this.socket.onerror=t=>{console.error("[WebSocket] Error:",t)}}send(e){this.socket&&this.socket.readyState===WebSocket.OPEN&&this.isConnected?this.socket.send(JSON.stringify(e)):(console.warn("[WebSocket] Not ready, message enqueued."),this.messageQueue.push(e))}on(e,t){this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t)}off(e,t){const o=this.callbacks[e];o&&(this.callbacks[e]=o.filter(s=>s!==t))}dispatchMessage(e){const t=e.type;console.log("[WebSocket] dispatchMessage",t);const o=this.callbacks[t];o&&o.length>0?o.forEach(s=>s(e)):t in this.callbacks||console.warn("[WebSocket] Unhandled message type:",t,e)}};b(q,"instance");let T=q;const H=class H{constructor(){b(this,"localId","esperando");b(this,"opponentId",null);b(this,"matchId",null)}static getInstance(){return H.instance||(H.instance=new H),H.instance}setLocalId(e){this.localId=e;const t=document.getElementById("local-id-display");t&&(t.textContent=`Tu ID: ${e}`)}getLocalId(){return this.localId}setOpponentId(e){this.opponentId=e}getOpponentId(){return this.opponentId}setMatchId(e){this.matchId=e}getMatchId(){return this.matchId}reset(){this.opponentId=null,this.matchId=null}};b(H,"instance");let x=H;function fe(n){const e=document.getElementById("app");e.innerHTML="";const t=document.createElement("div");t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.justifyContent="center",t.style.height="100vh",t.style.gap="20px";const o=document.createElement("h2");o.textContent=`Invitación de: ${n.fromId}`,t.appendChild(o);const s=document.createElement("button");s.textContent="Aceptar",s.style.padding="10px 20px",s.style.fontSize="16px",s.style.cursor="pointer";const a=document.createElement("button");a.textContent="Rechazar",a.style.padding="10px 20px",a.style.fontSize="16px",a.style.cursor="pointer",s.onclick=()=>{const i=x.getInstance().getLocalId();x.getInstance().setOpponentId(n.fromId);const c={type:"join_response",accepted:!0,fromId:i,toId:n.fromId};T.getInstance().send(c)},a.onclick=()=>{const i={type:"join_response",accepted:!1,fromId:x.getInstance().getLocalId(),toId:n.fromId};T.getInstance().send(i),e.innerHTML="<p>Has rechazado la invitación.</p>"},t.appendChild(s),t.appendChild(a),e.appendChild(t)}let ye=1e3;function we(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`piece_${ye++}`}function K(n){return n.map(e=>e.map(t=>t?{...t}:null))}class Y{constructor(e){b(this,"board");b(this,"currentTurn");b(this,"hasMoved",{});b(this,"enPassantTarget",null);b(this,"moveHistory",[]);this.board=K(e),this.currentTurn="white"}clone(){const e=new Y(K(this.board));return e.currentTurn=this.currentTurn,e.hasMoved={...this.hasMoved},e.enPassantTarget=this.enPassantTarget?{...this.enPassantTarget}:null,e.moveHistory=[...this.moveHistory],e}isInCheck(e){let t=null;for(let s=0;s<8;s++){for(let a=0;a<8;a++){const i=this.board[s][a];if((i==null?void 0:i.type)==="king"&&i.color===e){t={row:s,col:a};break}}if(t)break}if(!t)return!1;const o=e==="white"?"black":"white";for(let s=0;s<8;s++)for(let a=0;a<8;a++){const i=this.board[s][a];if(i&&i.color===o&&this.getRawMoves({row:s,col:a},!0).some(u=>u.row===t.row&&u.col===t.col))return!0}return!1}getBoard(){return K(this.board)}getCurrentTurn(){return this.currentTurn}getMoveHistory(){return[...this.moveHistory]}makeMove(e,t){return!this.board[e.row][e.col]||!this.getLegalMoves(e).some(i=>i.row===t.row&&i.col===t.col)?!1:(this.applyMove(e,t),!0)}applyMove(e,t){const o=this.board[e.row][e.col];if(this.hasMoved[o.id]=!0,this.moveHistory.push({from:{...e},to:{...t}}),o.type==="pawn"&&this.enPassantTarget&&t.row===this.enPassantTarget.row&&t.col===this.enPassantTarget.col){const a=o.color==="white"?1:-1;this.board[t.row+a][t.col]=null}if(o.type==="king"&&Math.abs(t.col-e.col)===2){const a=e.row;t.col===6?(this.board[a][5]=this.board[a][7],this.board[a][7]=null):t.col===2&&(this.board[a][3]=this.board[a][0],this.board[a][0]=null)}this.board[t.row][t.col]=o,this.board[e.row][e.col]=null,this.currentTurn=this.currentTurn==="white"?"black":"white",o.type==="pawn"&&Math.abs(t.row-e.row)===2?this.enPassantTarget={row:(e.row+t.row)/2,col:e.col}:this.enPassantTarget=null;const s=o.color==="white"?0:7;o.type==="pawn"&&t.row===s&&(this.board[t.row][t.col]={id:we(),type:"queen",color:o.color,image:`${o.color}_queen.png`,dragImage:`${o.color}_queen_drag.png`})}getLegalMoves(e){var d,g,f,l;const t=this.board[e.row][e.col];if(!t)return[];const o=t.color,s=[],a=(r,h)=>{if(r>=0&&r<8&&h>=0&&h<8){const m=this.board[r][h];(!m||m.color!==o)&&s.push({row:r,col:h})}};if(t.type==="pawn"){const r=o==="white"?-1:1,h=o==="white"?6:1,m=e.row+r,y=e.row+r*2;((d=this.board[m])==null?void 0:d[e.col])===null&&(s.push({row:m,col:e.col}),e.row===h&&((g=this.board[y])==null?void 0:g[e.col])===null&&s.push({row:y,col:e.col}));for(const I of[-1,1]){const k=e.col+I,D=e.row+r;if(k>=0&&k<8){const O=(f=this.board[D])==null?void 0:f[k];O&&O.color!==o&&s.push({row:D,col:k}),((l=this.enPassantTarget)==null?void 0:l.row)===D&&this.enPassantTarget.col===k&&s.push({row:D,col:k})}}}t.type==="knight"&&[[2,1],[1,2],[-1,2],[-2,1],[-2,-1],[-1,-2],[1,-2],[2,-1]].forEach(([r,h])=>a(e.row+r,e.col+h));const i=[[-1,-1],[-1,1],[1,-1],[1,1]],c=[[-1,0],[1,0],[0,-1],[0,1]],u=[...i,...c],p=[];t.type==="bishop"&&p.push(...i),t.type==="rook"&&p.push(...c),t.type==="queen"&&p.push(...u);for(const[r,h]of p){let m=e.row+r,y=e.col+h;for(;m>=0&&m<8&&y>=0&&y<8;){const I=this.board[m][y];if(!I)s.push({row:m,col:y});else{I.color!==o&&s.push({row:m,col:y});break}m+=r,y+=h}}if(t.type==="king"){for(const[r,h]of[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]])a(e.row+r,e.col+h);if(!this.hasMoved[t.id]&&!this.isInCheck(o)){const r=e.row,h=this.board[r][7];h&&h.type==="rook"&&h.color===o&&!this.hasMoved[h.id]&&this.board[r][5]===null&&this.board[r][6]===null&&!this.isAttacked({row:r,col:5},o)&&!this.isAttacked({row:r,col:6},o)&&s.push({row:r,col:6});const m=this.board[r][0];m&&m.type==="rook"&&m.color===o&&!this.hasMoved[m.id]&&this.board[r][1]===null&&this.board[r][2]===null&&this.board[r][3]===null&&!this.isAttacked({row:r,col:2},o)&&!this.isAttacked({row:r,col:3},o)&&s.push({row:r,col:2})}}return s.filter(r=>{const h=this.clone();return h.applyMove(e,r),!h.isInCheck(o)})}hasAnyLegalMove(e){for(let t=0;t<8;t++)for(let o=0;o<8;o++){const s=this.board[t][o];if((s==null?void 0:s.color)===e&&this.getLegalMoves({row:t,col:o}).length>0)return!0}return!1}getRawMoves(e,t=!1){var g,f;const o=this.board[e.row][e.col];if(!o)return[];const s=o.color,a=[],i=(l,r)=>{l>=0&&l<8&&r>=0&&r<8&&a.push({row:l,col:r})};if(o.type==="pawn"){const l=s==="white"?-1:1,r=s==="white"?6:1,h=e.row+l,m=e.row+l*2;t||((g=this.board[h])==null?void 0:g[e.col])===null&&(a.push({row:h,col:e.col}),e.row===r&&((f=this.board[m])==null?void 0:f[e.col])===null&&a.push({row:m,col:e.col}));for(const y of[-1,1]){const I=e.col+y,k=e.row+l;I>=0&&I<8&&k>=0&&k<8&&a.push({row:k,col:I})}}o.type==="knight"&&[[2,1],[1,2],[-1,2],[-2,1],[-2,-1],[-1,-2],[1,-2],[2,-1]].forEach(([l,r])=>i(e.row+l,e.col+r));const c=[[-1,-1],[-1,1],[1,-1],[1,1]],u=[[-1,0],[1,0],[0,-1],[0,1]],p=[...c,...u],d=[];o.type==="bishop"&&d.push(...c),o.type==="rook"&&d.push(...u),o.type==="queen"&&d.push(...p);for(const[l,r]of d){let h=e.row+l,m=e.col+r;for(;h>=0&&h<8&&m>=0&&m<8&&(i(h,m),!this.board[h][m]);)h+=l,m+=r}if(o.type==="king")for(const[l,r]of[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]])i(e.row+l,e.col+r);return a}isAttacked(e,t){const o=t==="white"?"black":"white";for(let s=0;s<8;s++)for(let a=0;a<8;a++){const i=this.board[s][a];if(i&&i.color===o&&this.getRawMoves({row:s,col:a},!0).some(u=>u.row===e.row&&u.col===e.col))return!0}return!1}}const P=class P{constructor(){b(this,"sounds");this.sounds={drag:new Audio("/assets/sounds/drag.mp3"),capture:new Audio("/assets/sounds/capture.mp3"),check:new Audio("/assets/sounds/check.mp3"),horse:new Audio("/assets/sounds/horse.mp3"),move:new Audio("/assets/sounds/move.mp3"),error:new Audio("/assets/sounds/error.mp3")}}static getInstance(){return P.instance||(P.instance=new P),P.instance}play(e){const t=this.sounds[e];t?(t.currentTime=0,t.play().catch(o=>{console.warn(`[AUDIO ERROR] Fallo al reproducir '${e}':`,o)})):console.warn(`[AUDIO] Sonido no encontrado: '${e}'`)}};b(P,"instance");let V=P;const v=V.getInstance();let be=0;function w(){return`piece_${be++}`}const le=[[{id:w(),type:"rook",color:"black",image:"black_rook.png",dragImage:"black_rook_drag.png"},{id:w(),type:"knight",color:"black",image:"black_knight.png",dragImage:"black_knight_drag.png"},{id:w(),type:"bishop",color:"black",image:"black_bishop.png",dragImage:"black_bishop_drag.png"},{id:w(),type:"queen",color:"black",image:"black_queen.png",dragImage:"black_queen_drag.png"},{id:w(),type:"king",color:"black",image:"black_king.png",dragImage:"black_king_drag.png"},{id:w(),type:"bishop",color:"black",image:"black_bishop2.png",dragImage:"black_bishop2_drag.png"},{id:w(),type:"knight",color:"black",image:"black_knight2.png",dragImage:"black_knight2_drag.png"},{id:w(),type:"rook",color:"black",image:"black_rook2.png",dragImage:"black_rook2_drag.png"}],[{id:w(),type:"pawn",color:"black",image:"black_pawn1.png",dragImage:"black_pawn1_drag.png"},{id:w(),type:"pawn",color:"black",image:"black_pawn2.png",dragImage:"black_pawn2_drag.png"},{id:w(),type:"pawn",color:"black",image:"black_pawn3.png",dragImage:"black_pawn3_drag.png"},{id:w(),type:"pawn",color:"black",image:"black_pawn4.png",dragImage:"black_pawn4_drag.png"},{id:w(),type:"pawn",color:"black",image:"black_pawn5.png",dragImage:"black_pawn5_drag.png"},{id:w(),type:"pawn",color:"black",image:"black_pawn6.png",dragImage:"black_pawn6_drag.png"},{id:w(),type:"pawn",color:"black",image:"black_pawn7.png",dragImage:"black_pawn7_drag.png"},{id:w(),type:"pawn",color:"black",image:"black_pawn8.png",dragImage:"black_pawn8_drag.png"}],Array(8).fill(null),Array(8).fill(null),Array(8).fill(null),Array(8).fill(null),[{id:w(),type:"pawn",color:"white",image:"white_pawn1.png",dragImage:"white_pawn1_drag.png"},{id:w(),type:"pawn",color:"white",image:"white_pawn2.png",dragImage:"white_pawn2_drag.png"},{id:w(),type:"pawn",color:"white",image:"white_pawn3.png",dragImage:"white_pawn3_drag.png"},{id:w(),type:"pawn",color:"white",image:"white_pawn4.png",dragImage:"white_pawn4_drag.png"},{id:w(),type:"pawn",color:"white",image:"white_pawn5.png",dragImage:"white_pawn5_drag.png"},{id:w(),type:"pawn",color:"white",image:"white_pawn6.png",dragImage:"white_pawn6_drag.png"},{id:w(),type:"pawn",color:"white",image:"white_pawn7.png",dragImage:"white_pawn7_drag.png"},{id:w(),type:"pawn",color:"white",image:"white_pawn8.png",dragImage:"white_pawn8_drag.png"}],[{id:w(),type:"rook",color:"white",image:"white_rook.png",dragImage:"white_rook_drag.png"},{id:w(),type:"knight",color:"white",image:"white_knight.png",dragImage:"white_knight_drag.png"},{id:w(),type:"bishop",color:"white",image:"white_bishop.png",dragImage:"white_bishop_drag.png"},{id:w(),type:"queen",color:"white",image:"white_queen.png",dragImage:"white_queen_drag.png"},{id:w(),type:"king",color:"white",image:"white_king.png",dragImage:"white_king_drag.png"},{id:w(),type:"bishop",color:"white",image:"white_bishop2.png",dragImage:"white_bishop2_drag.png"},{id:w(),type:"knight",color:"white",image:"white_knight2.png",dragImage:"white_knight2_drag.png"},{id:w(),type:"rook",color:"white",image:"white_rook2.png",dragImage:"white_rook2_drag.png"}]];function se(n){const e=Math.floor(n/60),t=n%60;return`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`}function ce(n,e){const t=document.createElement("div");t.id="black-timer",t.className="timer-box";const o=document.createElement("div");if(o.id="white-timer",o.className="timer-box",!document.getElementById("timers-style")){const a=document.createElement("style");a.id="timers-style",a.textContent=`
      .timer-box {
        position: fixed;
        right: 10px;
        width: auto;
        min-width: 100px;
        max-width: 160px;
        background: rgba(0, 0, 0, 0.5);
        color: #fff;
        font-family: monospace;
        font-size: 1.3rem;
        padding: 10px 14px;
        border-radius: 8px;
        text-align: right;
        z-index: 1000;
        pointer-events: none;
        box-shadow: 0 0 8px rgba(0,0,0,0.4);
        user-select: none;
      }

      #black-timer {
        top: 10px;
      }

      #white-timer {
        bottom: 10px;
      }

      #board-holder {
        margin-top: 80px;
        margin-bottom: 80px;
      }

      @media (max-width: 500px) {
        .timer-box {
          font-size: 1rem;
          padding: 8px 10px;
          min-width: 80px;
        }
      }
    `,document.head.appendChild(a)}document.body.appendChild(t),document.body.appendChild(o);function s(){t.textContent=se(e.getTime("black")),o.textContent=se(e.getTime("white")),requestAnimationFrame(s)}s()}const re={"no-time":{base:1/0,increment:0},blitz:{base:3*60,increment:2},rapid:{base:10*60,increment:5},classic:{base:15*60,increment:0}};class de{constructor(e,t){b(this,"whiteTime");b(this,"blackTime");b(this,"activeColor","white");b(this,"intervalId",null);b(this,"increment");b(this,"updateCallback",null);this.control=e,this.onTimeout=t;const{base:o,increment:s}=re[e];this.whiteTime=o,this.blackTime=o,this.increment=s}setUpdateCallback(e){this.updateCallback=e}startTurn(e){this.stop(),this.activeColor=e,this.control!=="no-time"&&(this.intervalId=window.setInterval(()=>{var t;this.activeColor==="white"?this.whiteTime--:this.blackTime--,(t=this.updateCallback)==null||t.call(this),this.getTime(e)<=0&&(this.stop(),this.onTimeout(e))},1e3))}stop(){this.intervalId!==null&&(clearInterval(this.intervalId),this.intervalId=null)}addIncrement(e){this.increment>0&&this.control!=="no-time"&&(e==="white"?this.whiteTime+=this.increment:this.blackTime+=this.increment)}getTime(e){return e==="white"?this.whiteTime:this.blackTime}formatTime(e){if(e===1/0)return"∞";const t=Math.floor(e/60).toString().padStart(2,"0"),o=Math.floor(e%60).toString().padStart(2,"0");return`${t}:${o}`}getFormattedTime(e){return this.formatTime(this.getTime(e))}getActiveColor(){return this.activeColor}reset(){this.stop();const{base:e}=re[this.control];this.whiteTime=e,this.blackTime=e,this.activeColor="white"}}let C=new de("classic",()=>{});function ke(n){C=n}const Ie={white:[[{from:{row:6,col:4},to:{row:4,col:4}},{from:{row:7,col:6},to:{row:5,col:5}}],[{from:{row:6,col:3},to:{row:4,col:3}},{from:{row:7,col:1},to:{row:5,col:2}}]],black:[[{from:{row:1,col:4},to:{row:3,col:4}},{from:{row:0,col:6},to:{row:2,col:5}}],[{from:{row:1,col:3},to:{row:3,col:3}},{from:{row:0,col:1},to:{row:2,col:2}}]]};function pe(n,e,t){if(t){const c=t.getCurrentTurn();if(!t.hasAnyLegalMove(c)&&t.isInCheck(c))return c!==e?1e4:-1e4;if(!t.hasAnyLegalMove(c)&&!t.isInCheck(c))return 0}const o={pawn:1,knight:3,bishop:3,rook:5,queen:9,king:100};let s=0,a=0,i=null;for(let c=0;c<8;c++)for(let u=0;u<8;u++){const p=n[c][u];if(p){const d=o[p.type];s+=p.color===e?d:-d,a++,p.type==="king"&&p.color!==e&&(i={row:c,col:u})}}if(t){const c=N(t).length,u=t.getCurrentTurn();t.currentTurn=u==="white"?"black":"white";const p=N(t).length;t.currentTurn=u,s+=.1*(c-p)}if(a<=5&&i){const u=Math.min(...[{row:0,col:0},{row:0,col:7},{row:7,col:0},{row:7,col:7}].map(p=>Math.abs(p.row-i.row)+Math.abs(p.col-i.col)));s+=(14-u)*.5}return s+=Math.random()*.01,s}function N(n){const e=n.getBoard(),t=n.getCurrentTurn(),o=[];for(let s=0;s<8;s++)for(let a=0;a<8;a++){const i=e[s][a];if(i&&i.color===t){const c={row:s,col:a};for(const u of n.getLegalMoves(c))o.push({from:c,to:u})}}return o}function X(n,e,t,o){if(e===0||N(n).length===0)return pe(n.getBoard(),o,n);const s=N(n);if(t){let a=-1/0;for(const i of s){const c=n.clone();c.makeMove(i.from,i.to);const u=X(c,e-1,!1,o);a=Math.max(a,u)}return a}else{let a=1/0;for(const i of s){const c=n.clone();c.makeMove(i.from,i.to);const u=X(c,e-1,!0,o);a=Math.min(a,u)}return a}}function Z(n,e,t,o,s,a){if(e===0||N(n).length===0)return pe(n.getBoard(),a,n);const i=N(n);if(s){let c=-1/0;for(const u of i){const p=n.clone();if(p.makeMove(u.from,u.to),c=Math.max(c,Z(p,e-1,t,o,!1,a)),t=Math.max(t,c),t>=o)break}return c}else{let c=1/0;for(const u of i){const p=n.clone();if(p.makeMove(u.from,u.to),c=Math.min(c,Z(p,e-1,t,o,!0,a)),o=Math.min(o,c),o<=t)break}return c}}function ve(n,e){var f;const t=n.getBoard(),o=n.getCurrentTurn(),s=[];for(let l=0;l<8;l++)for(let r=0;r<8;r++){const h=t[l][r];if(h&&h.color===o){const m={row:l,col:r};for(const y of n.getLegalMoves(m)){const I=t[y.row][y.col];s.push({from:m,to:y,capture:!!I})}}}if(s.length===0)return null;const a=((f=n.getMoveHistory)==null?void 0:f.call(n).length)??0;if(e!=="easy"&&a<4){const l=Ie[o],h=l[Math.floor(Math.random()*l.length)][a/2];if(h&&n.getLegalMoves(h.from).some(m=>m.row===h.to.row&&m.col===h.to.col)){const m=n.makeMove(h.from,h.to),y=t[h.to.row][h.to.col];return m?{from:h.from,to:h.to,capture:!!y}:null}}for(const l of s){const r=n.clone();r.makeMove(l.from,l.to);const h=r.getCurrentTurn();if(!r.hasAnyLegalMove(h)&&r.isInCheck(h))return n.makeMove(l.from,l.to)?{from:l.from,to:l.to,capture:l.capture,checkmate:!0}:null}let i=[],c=-1/0;if(e==="easy"){const l=s.filter(r=>r.capture);i=l.length>0?[l[Math.floor(Math.random()*l.length)]]:[s[Math.floor(Math.random()*s.length)]]}else{const l=e==="medium"?1:2;for(const r of s){const h=n.clone();h.makeMove(r.from,r.to);const m=e==="medium"?X(h,l-1,!1,o):Z(h,l-1,-1/0,1/0,!1,o);m>c?(c=m,i=[r]):m===c&&i.push(r)}}const u=i[Math.floor(Math.random()*i.length)],p=n.makeMove(u.from,u.to),d=n.getCurrentTurn(),g=!n.hasAnyLegalMove(d)&&n.isInCheck(d);return p?{from:u.from,to:u.to,capture:u.capture,checkmate:g}:null}function U(n,e,t){const o=document.getElementById("app"),s=document.createElement("div");s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.display="flex",s.style.flexDirection="column",s.style.justifyContent="center",s.style.alignItems="center",s.style.zIndex="9999",s.style.animation="fadeIn 0.5s ease";let a="linear-gradient(to bottom right, rgba(0,0,0,0.8), rgba(30,30,30,0.9))";n.toLowerCase().includes("white")?a="linear-gradient(to bottom right, rgba(255,255,255,0.8), rgba(200,200,200,0.9))":n.toLowerCase().includes("black")?a="linear-gradient(to bottom right, rgba(0,0,0,0.8), rgba(20,20,20,0.95))":a="linear-gradient(to bottom right, rgba(100,100,100,0.8), rgba(60,60,60,0.9))",s.style.background=a;const i=document.createElement("div");i.style.backgroundColor="#fff",i.style.padding="40px",i.style.borderRadius="15px",i.style.boxShadow="0 0 25px rgba(255, 255, 255, 0.1)",i.style.textAlign="center",i.style.animation="popUp 0.5s ease",i.style.maxWidth="90%",i.style.minWidth="300px";const c=document.createElement("img");c.src="/logo.png",c.alt="Game Logo",c.style.width="80px",c.style.marginBottom="20px";const u=document.createElement("div");u.style.fontSize="3rem",u.style.marginBottom="10px";let p=new Audio,d=n;n.toLowerCase().includes("white")?(u.textContent="♔",u.style.color="#ddd",d=window.playerColor==="white"?"You Won!":"You Lost!",p=new Audio(window.playerColor==="white"?"/assets/sounds/victory.mp3":"/assets/sounds/defeat.mp3")):n.toLowerCase().includes("black")?(u.textContent="♚",u.style.color="#222",d=window.playerColor==="black"?"You Won!":"You Lost!",p=new Audio(window.playerColor==="black"?"/assets/sounds/victory.mp3":"/assets/sounds/defeat.mp3")):n.toLowerCase().includes("desconect")?(u.textContent="❌",u.style.color="#e74c3c",d="Your opponent disconnected.",p=new Audio("/assets/sounds/defeat.mp3")):(u.textContent="🤝",u.style.color="#888",d="Draw!",p=new Audio("/assets/sounds/draw.mp3")),p.play().catch(console.error);const g=document.createElement("h2");g.textContent=d,g.style.margin="0",g.style.fontSize="2rem",g.style.color="#333";const f=document.createElement("div");f.style.marginTop="25px",f.style.display="flex",f.style.justifyContent="center",f.style.gap="15px",f.style.flexWrap="wrap";const l=document.createElement("button");l.textContent="Play Again",l.style.padding="12px 25px",l.style.fontSize="1rem",l.style.cursor="pointer",l.style.backgroundColor="#444",l.style.color="white",l.style.border="none",l.style.borderRadius="8px",l.style.transition="background-color 0.3s",l.tabIndex=0,l.onmouseenter=()=>l.style.backgroundColor="#666",l.onmouseleave=()=>l.style.backgroundColor="#444",l.onclick=()=>{s.remove(),J(),e()};const r=document.createElement("button");if(r.textContent="Main Menu",r.style.padding="12px 25px",r.style.fontSize="1rem",r.style.cursor="pointer",r.style.backgroundColor="#222",r.style.color="white",r.style.border="none",r.style.borderRadius="8px",r.style.transition="background-color 0.3s",r.tabIndex=0,r.onmouseenter=()=>r.style.backgroundColor="#444",r.onmouseleave=()=>r.style.backgroundColor="#222",r.onclick=()=>{s.remove(),J(),t()},!document.getElementById("gameover-modal-style")){const m=document.createElement("style");m.id="gameover-modal-style",m.innerHTML=`
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      @keyframes popUp {
        0% { transform: scale(0.6); opacity: 0; }
        100% { transform: scale(1); opacity: 1; }
      }
    `,document.head.appendChild(m)}f.appendChild(l),f.appendChild(r),i.appendChild(c),i.appendChild(u),i.appendChild(g),i.appendChild(f),s.appendChild(i),o.appendChild(s);const h=m=>{m.key==="Escape"&&(s.remove(),J(),t(),window.removeEventListener("keydown",h))};window.addEventListener("keydown",h)}class Ce{constructor(){b(this,"config",null)}setConfig(e){this.config=e,window.playerColor=e.playerColor}getConfig(){if(!this.config)throw new Error("Game configuration not set.");return this.config}getPlayerColor(){if(!this.config)throw new Error("Game configuration not set.");return this.config.playerColor}isAgainstAI(){var e;return((e=this.config)==null?void 0:e.mode)==="ai"}reset(){this.config=null,delete window.playerColor}}const R=new Ce;function xe(){const n=document.getElementById("app");n.innerHTML="";const e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center",e.style.justifyContent="center",e.style.gap="20px",e.style.padding="40px";const t=document.createElement("h2");t.textContent="Select AI Difficulty",e.appendChild(t);const o=[{label:"🟢 Easy",value:"easy"},{label:"🟡 Medium",value:"medium"},{label:"🔴 Hard",value:"hard"}];let s="easy";for(const{label:u,value:p}of o){const d=document.createElement("button");d.textContent=u,d.style.padding="12px 24px",d.style.fontSize="1.1rem",d.style.cursor="pointer",d.style.width="220px",d.addEventListener("click",()=>{s=p,a()}),e.appendChild(d)}n.appendChild(e);function a(){e.innerHTML="";const u=document.createElement("h2");u.textContent="Who Starts?",e.appendChild(u);const p=document.createElement("button");p.textContent="You Start",i(p);const d=document.createElement("button");d.textContent="AI Starts",i(d),p.addEventListener("click",()=>{c(),R.setConfig({mode:"ai",playerColor:"white",aiLevel:s}),F()}),d.addEventListener("click",()=>{c(),R.setConfig({mode:"ai",playerColor:"black",aiLevel:s}),F()}),e.appendChild(p),e.appendChild(d)}function i(u){u.style.padding="12px 24px",u.style.fontSize="1.1rem",u.style.cursor="pointer",u.style.width="220px"}function c(){e.querySelectorAll("button").forEach(p=>p.disabled=!0)}}let $=null;function Te(){const n=document.getElementById("app");n.innerHTML="";const e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center",e.style.justifyContent="center",e.style.height="100vh",e.style.gap="20px";const t=document.createElement("p");t.textContent="Esperando a que el oponente acepte la invitación...",e.appendChild(t);const o=document.createElement("button");o.textContent="Cancelar",o.style.padding="10px 20px",o.style.fontSize="16px",o.style.cursor="pointer",o.onclick=()=>{T.getInstance().send({type:"error",message:"Invitación cancelada por el remitente."}),$&&(T.getInstance().off("join_response",$),$=null),L()},e.appendChild(o),n.appendChild(e),$&&T.getInstance().off("join_response",$),$=s=>{const a=s;if(a.accepted){const i=`${a.fromId}-${x.getInstance().getLocalId()}`;x.getInstance().setMatchId(i),console.log("[WaitingScreen] Invitación aceptada. Esperando inicio de partida desde el servidor.")}else alert("El oponente ha rechazado la invitación."),L();T.getInstance().off("join_response",$),$=null},T.getInstance().on("join_response",$)}function Me(){const n=document.getElementById("app");n.innerHTML="";const e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center",e.style.justifyContent="center",e.style.height="100vh",e.style.gap="20px";const t=document.createElement("h2");t.textContent="Conectar con otro jugador",e.appendChild(t);const o=document.createElement("p");o.id="local-id-display",o.style.fontWeight="bold",o.textContent="Tu ID: esperando...",e.appendChild(o);const s=x.getInstance().getLocalId();s&&(o.textContent=`Tu ID: ${s}`);const a=document.createElement("input");a.type="text",a.placeholder="Introduce el ID del oponente",a.id="opponent-id",a.name="opponent-id",a.style.padding="10px",a.style.fontSize="16px",a.style.width="250px",e.appendChild(a);const i=document.createElement("button");i.textContent="Enviar invitación",i.style.padding="10px 20px",i.style.fontSize="16px",i.style.cursor="pointer",e.appendChild(i);const c=document.createElement("p");c.style.color="red",e.appendChild(c),i.onclick=()=>{const u=a.value.trim(),p=x.getInstance().getLocalId();if(!u){c.textContent="Por favor, introduce un ID válido.";return}x.getInstance().setOpponentId(u);const d={type:"join_request",fromId:p,toId:u};T.getInstance().send(d),Te()},n.appendChild(e)}function L(){const n=document.getElementById("app");n.innerHTML="";const e=document.createElement("div");e.id="menu-screen";const t=x.getInstance().getLocalId()||"(esperando ID...)",o=document.createElement("div");o.style.position="absolute",o.style.top="50%",o.style.left="50%",o.style.transform="translate(-50%, -60%)",o.style.opacity="0",o.style.transition="opacity 0.6s ease, transform 0.6s ease",o.style.display="flex",o.style.justifyContent="center",o.style.alignItems="center",o.style.gap="0.75rem",o.style.background="rgba(0, 0, 0, 0.5)",o.style.padding="1rem 2rem",o.style.borderRadius="12px";const s=document.createElement("img");s.src="/assets/img/userID.png",s.alt="user icon",s.style.width="60px",s.style.height="60px";const a=document.createElement("div");a.className="player-id",a.innerHTML=`<strong>${t}</strong>`,a.style.fontSize="1.6rem",a.style.color="white",a.style.whiteSpace="nowrap",a.style.display="flex",a.style.alignItems="center",a.style.gap="0.5rem";const i=document.createElement("img");i.src="/assets/img/copy.png",i.alt="Copiar ID",i.style.width="60px",i.style.height="60px",i.style.cursor="pointer",i.title="Copiar ID",i.addEventListener("click",()=>{navigator.clipboard.writeText(t).then(()=>{i.src="/assets/img/check.png",setTimeout(()=>i.src="/assets/img/copy.png",1500)})}),o.appendChild(s),o.appendChild(a),o.appendChild(i),e.appendChild(o),setTimeout(()=>{o.style.opacity="1",o.style.transform="translate(-50%, -50%)"},50);const c=document.createElement("div");c.className="menu-buttons",c.style.flexDirection="row",c.style.justifyContent="center";const u=[{label:"Jugar contra la IA",value:"ai"},{label:"Jugar con un amigo",value:"id"},{label:"Jugar en línea",value:"random"}];for(const{label:p,value:d}of u){const g=document.createElement("button");g.className="menu-btn",g.textContent=p,g.addEventListener("click",()=>{if(J(),d==="ai")xe();else if(d==="id")Me();else if(d==="random"){const f=x.getInstance().getLocalId();if(!f||f==="esperando"){alert("Esperando asignación de ID por el servidor. Intenta de nuevo en unos segundos.");return}T.getInstance().send({type:"find_random_opponent",id:f}),alert("Buscando oponente aleatorio...")}}),c.appendChild(g)}e.appendChild(c),n.appendChild(e)}let j=!0,A=null,S=null,E=null;function ue(){const n=["rook","rook2","knight","knight2","bishop","bishop2","queen","king"],e=Array.from({length:8},(i,c)=>`pawn${c+1}`),t=[...n,...e],o=["white","black"],s=["","_drag","_check"];let a=document.getElementById("preload-pieces");a||(a=document.createElement("div"),a.id="preload-pieces",a.style.position="absolute",a.style.top="-9999px",a.style.left="-9999px",document.body.appendChild(a));for(const i of o)for(const c of t)for(const u of s){if(u==="_check"&&c!=="king")continue;const p=`${i}_${c}${u}.png`;if(!document.getElementById(p)){const d=new Image;d.id=p,d.src=`/assets/pieces/${p}`,d.style.width="1px",d.style.height="1px",d.onload=()=>console.log(`Imagen precargada: ${p}`),d.onerror=()=>console.warn(`No se pudo cargar: ${p}`),a.appendChild(d)}}}ue();document.addEventListener("click",function n(){console.log("[AUDIO] Desbloqueando sonido con primer click"),document.removeEventListener("click",n)},{once:!0});function F(){const n=document.getElementById("app");n.innerHTML="";let e=document.getElementById("board-holder");e||(e=document.createElement("div"),e.id="board-holder",n.appendChild(e)),ue();const t=R.getConfig();let o;t.mode==="online"?o=Se():o=new Y(le),ce(n,C),B(o,o.getBoard()),j=t.mode!=="ai"||t.playerColor==="white",C.startTurn(o.getCurrentTurn()),t.mode==="ai"&&t.playerColor==="black"&&setTimeout(()=>ee(o),500)}function _e(n,e,t,o){const s=n.getBoard().map(g=>g.map(f=>f?{...f}:null)),a=document.getElementById("chess-board");if(console.log("[animateRemoteMove] Animando movimiento remoto",e,t),!a){console.warn("[animateRemoteMove] No se encontró el tablero.");return}const i=e.row*8+e.col,c=t.row*8+t.col,u=a.children[i],p=a.children[c],d=u==null?void 0:u.querySelector("img");if(d&&p){console.log("[animateRemoteMove] Imagen encontrada para animar:",d.src);const g=d.dataset.dragSrc||d.dataset.defaultSrc;g&&(d.src=`/assets/pieces/${g}`);const f=d.getBoundingClientRect(),l=p.getBoundingClientRect(),r=d.cloneNode(!0);r.style.position="fixed",r.style.left=`${f.left}px`,r.style.top=`${f.top}px`,r.style.width=`${f.width}px`,r.style.height=`${f.height}px`,r.style.pointerEvents="none",r.style.transition="left 0.4s linear, top 0.4s linear, opacity 0.1s",document.body.appendChild(r),d.style.visibility="hidden",setTimeout(()=>{r.style.left=`${l.left}px`,r.style.top=`${l.top}px`},10),setTimeout(()=>{r.style.opacity="0",setTimeout(()=>{document.body.removeChild(r),d.style.visibility="visible",d.src=`/assets/pieces/${d.dataset.defaultSrc}`;const m=s[t.row][t.col]!==null;n.makeMove(e,t),E={from:e,to:t},m?v.play("capture"):v.play("move");const y=n.getCurrentTurn();R.getConfig(),C.addIncrement(y==="white"?"black":"white"),C.startTurn(y),B(n,n.getBoard()),n.isInCheck(y)&&v.play("check"),o&&o()},100)},1e3)}else{console.warn("[animateRemoteMove] No se pudo encontrar la imagen para animar el movimiento.");const f=n.getBoard()[t.row][t.col]!==null;n.makeMove(e,t),E={from:e,to:t},v.play(f?"capture":"move");const l=n.getCurrentTurn();C.addIncrement(l==="white"?"black":"white"),C.startTurn(l),B(n,n.getBoard()),n.isInCheck(l)&&v.play("check"),o&&o()}}function B(n,e){if(!n){console.error("Engine is not initialized. Call showBoard() first.");return}let t=document.getElementById("board-holder");if(!t){const p=document.getElementById("app");if(!p){console.error("No se encontró el contenedor #app");return}t=document.createElement("div"),t.id="board-holder",p.appendChild(t)}const o=document.createElement("div");o.id="chess-board",o.style.display="grid",o.style.gridTemplateColumns="repeat(8, 1fr)",o.style.width="min(90vmin, 90vw)",o.style.height="min(90vmin, 90vw)",o.style.margin="auto",o.style.border="4px solid black",t.innerHTML="",t.appendChild(o);const s=n.isInCheck("white"),a=n.isInCheck("black"),i=R.getConfig();let c=[];A&&(c=n.getLegalMoves(A));const u=["a","b","c","d","e","f","g","h"];for(let p=0;p<8;p++)for(let d=0;d<8;d++){const g=document.createElement("div"),f=(p+d)%2===0;if(g.style.backgroundColor=f?"#c2b280":"#6f4e37",g.style.width="100%",g.style.height="100%",g.style.position="relative",p===7){const r=document.createElement("span");r.textContent=u[d],r.className="cell-label file-label",g.appendChild(r)}if(d===0){const r=document.createElement("span");r.textContent=`${8-p}`,r.className="cell-label rank-label",g.appendChild(r)}const l=e[p][d];if(l){const r=document.createElement("img"),h=l.type==="king"&&(l.color==="white"&&s||l.color==="black"&&a);h&&g.classList.add("in-check");const m=h?`${l.color}_king_check.png`:l.image;if(r.src=`/assets/pieces/${m}`,r.dataset.defaultSrc=l.image,r.dataset.dragSrc=h?`${l.color}_king_check.png`:l.dragImage||l.image,r.style.width="100%",r.style.height="100%",r.style.objectFit="contain",r.draggable=!1,r.style.zIndex="10",g.appendChild(r),c.some(y=>y.row===p&&y.col===d)){const y=document.createElement("div");y.className="legal-move-dot",g.appendChild(y)}}if(A&&c.some(r=>r.row===p&&r.col===d)){const r=document.createElement("div");r.className="legal-move-dot",g.appendChild(r)}E&&(p===E.from.row&&d===E.from.col||p===E.to.row&&d===E.to.col)&&g.classList.add("last-move-cell"),g.addEventListener("click",()=>{if(!j||i.mode==="online"&&!Be())return;const r={row:p,col:d},h=e[p][d];if((!A||h&&h.color===i.playerColor)&&(S&&S.classList.remove("selected-cell"),h&&h.color===i.playerColor)){A=r,S=null,B(n,n.getBoard());const m=document.getElementById("chess-board");if(m){const y=r.row*8+r.col,I=m.children[y];I&&(I.classList.add("selected-cell"),S=I)}return}if(A){const m=A,y=e[r.row][r.col]!==null;if(n.makeMove(m,r)){A=null,S&&S.classList.remove("selected-cell"),S=null,j=!1,C.addIncrement(i.playerColor),C.startTurn(n.getCurrentTurn());const k=document.getElementById("chess-board");if(k){const D=m.row*8+m.col,O=r.row*8+r.col,Q=k.children[D],oe=k.children[O],_=Q==null?void 0:Q.querySelector("img");if(_&&oe){_.dataset.dragSrc&&(_.src=`/assets/pieces/${_.dataset.dragSrc}`),setTimeout(()=>{const G=_.getBoundingClientRect(),ne=oe.getBoundingClientRect(),M=_.cloneNode(!0);M.style.position="fixed",M.style.left=`${G.left}px`,M.style.top=`${G.top}px`,M.style.width=`${G.width}px`,M.style.height=`${G.height}px`,M.style.pointerEvents="none",M.style.transition="left 0.4s linear, top 0.4s linear, opacity 0.1s",document.body.appendChild(M),_.style.visibility="hidden",setTimeout(()=>{M.style.left=`${ne.left}px`,M.style.top=`${ne.top}px`},10),setTimeout(()=>{M.style.opacity="0",setTimeout(()=>{document.body.removeChild(M),_.dataset.defaultSrc&&(_.src=`/assets/pieces/${_.dataset.defaultSrc}`),_.style.visibility="visible",y?v.play("capture"):v.play("move"),E={from:m,to:r},B(n,n.getBoard());const me=n.getCurrentTurn();n.isInCheck(me)&&v.play("check"),i.mode==="online"&&ae(m,r),i.mode==="ai"&&n.getCurrentTurn()!==i.playerColor?setTimeout(()=>ee(n),1e3):j=!0},100)},510)},200);return}}y?v.play("capture"):v.play("move"),E={from:m,to:r},B(n,n.getBoard()),i.mode==="online"&&ae(m,r),i.mode==="ai"&&n.getCurrentTurn()!==i.playerColor?setTimeout(()=>ee(n),1e3):j=!0}else v.play("error"),A=null,S&&S.classList.remove("selected-cell"),S=null,B(n,n.getBoard())}}),o.appendChild(g)}}function ee(n){const e=R.getConfig();if(!e.aiLevel){console.error("AI difficulty level is not set."),U("AI configuration error. Returning to main menu.",()=>{L()},()=>{L()});return}const t=n.getBoard().map(p=>p.map(d=>d?{...d}:null)),o=ve(n,e.aiLevel);if(!o){const p=n.getCurrentTurn(),d=e.playerColor,g=n.isInCheck(p)&&p===d,f=n.isInCheck(p)&&p!==d,l=!n.isInCheck(p);let r="";g?r="¡Has perdido! (Jaque mate)":f?r="¡Has ganado! (Jaque mate)":l&&(r="Tablas (ahogado)"),U(r,()=>F(),()=>L());return}if(o.checkmate){const d=(n.getCurrentTurn()==="white"?"black":"white")===e.playerColor?"¡Has ganado! (Jaque mate)":"¡Has perdido! (Jaque mate)";setTimeout(()=>{U(d,()=>F(),()=>L())},300);return}const s=document.getElementById("chess-board");if(s){const p=o.from.row*8+o.from.col,d=o.to.row*8+o.to.col,g=s.children[p],f=s.children[d],l=g==null?void 0:g.querySelector("img");if(l&&f){l.dataset.dragSrc&&(l.src=`/assets/pieces/${l.dataset.dragSrc}`),setTimeout(()=>{const r=l.getBoundingClientRect(),h=f.getBoundingClientRect(),m=l.cloneNode(!0);m.style.position="fixed",m.style.left=`${r.left}px`,m.style.top=`${r.top}px`,m.style.width=`${r.width}px`,m.style.height=`${r.height}px`,m.style.pointerEvents="none",m.style.transition="left 0.4s linear, top 0.4s linear, opacity 0.1s",document.body.appendChild(m),l.style.visibility="hidden",setTimeout(()=>{m.style.left=`${h.left}px`,m.style.top=`${h.top}px`},10),setTimeout(()=>{m.style.opacity="0",setTimeout(()=>{document.body.removeChild(m),l.dataset.defaultSrc&&(l.src=`/assets/pieces/${l.dataset.defaultSrc}`),l.style.visibility="visible";const I=t[o.to.row][o.to.col]!==null;n.makeMove(o.from,o.to),E={from:o.from,to:o.to},I?v.play("capture"):v.play("move");const k=n.getCurrentTurn(),D=k==="white"?"black":"white";C.addIncrement(D),C.startTurn(k),B(n,n.getBoard()),n.isInCheck(k)&&v.play("check"),j=!0},100)},410)},200);return}}n.makeMove(o.from,o.to),E={from:o.from,to:o.to},n.getBoard();const a=t[o.to.row][o.to.col];a!==null&&a.color!==n.getCurrentTurn()?v.play("capture"):v.play("move");const c=n.getCurrentTurn(),u=c==="white"?"black":"white";C.addIncrement(u),C.startTurn(c),B(n,n.getBoard()),n.isInCheck(c)&&v.play("check"),console.log("AI move executed:",o),j=!0}let z,W=!1,te=!1;function Ee(n){if(console.log("[RemoteGame] startRemoteGame ejecutado",n),te){console.warn("[RemoteGame] La partida remota ya ha sido iniciada.");return}te=!0;const e=document.getElementById("app"),t=document.createElement("div");t.id="board-holder",e&&(e.innerHTML="",e.appendChild(t));const o=x.getInstance().getLocalId();if(!o){console.error("[RemoteGame] ERROR: El ID local no está asignado antes de iniciar la partida.");return}const s=n.whiteId===o?"white":"black";console.log(`[RemoteGame] Mi ID: ${o}, White: ${n.whiteId}, Black: ${n.blackId}, Mi color: ${s}`),console.log("[RemoteGame] Inicializando engine"),z=new Y(le),R.setConfig({mode:"online",playerColor:s}),W=s==="white",ke(new de("classic",a=>{const c=R.getConfig().playerColor;U(a===c?"¡Has perdido por tiempo!":"¡Has ganado por tiempo!",()=>L(),()=>L())})),C.reset(),W&&C.startTurn(s),ce(t,C),console.log("[Board] renderBoard llamado",z),B(z,z.getBoard())}function Le(n){console.log("[RemoteGame] handleRemoteMove",n),R.getConfig(),n.playerId!==x.getInstance().getLocalId()&&_e(z,n.from,n.to,()=>{W=!0})}function ae(n,e){const t={type:"move",from:n,to:e,playerId:x.getInstance().getLocalId()};T.getInstance().send(t),W=!1}function Se(){return z}function Be(){return W}function J(){te=!1}console.log("[Client] initWebSocketListeners ejecutado");let ie=!1;function $e(){if(console.log("[Client] initWebSocketListeners ejecutado"),ie)return;ie=!0;const n=T.getInstance();n.on("join_request",e=>{console.log("[Listener] join_request recibido",e),fe(e)}),n.on("start_game",e=>{console.log("[Listener] start_game recibido",e),Ee(e)}),n.on("join_response",e=>{e.accepted||(alert("El jugador rechazó la invitación o ya está en partida."),L())}),n.on("opponent_disconnected",e=>{"playerId"in e&&(alert("Tu oponente se ha desconectado."),L())}),n.on("init",e=>{const t=e;t.id!=="esperando"?(localStorage.setItem("playerId",t.id),x.getInstance().setLocalId(t.id),console.log("[Client] Received ID from server and stored:",t.id),L()):console.warn('[Client] ID "esperando" no se guarda en localStorage')}),n.on("move",e=>{Le(e)})}console.log("Starting Chess Game Client...");$e();const Ae=location.hostname==="localhost"?"ws://localhost:3000":"wss://cheess-game.onrender.com";T.getInstance().connect(Ae);
